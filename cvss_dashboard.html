<!DOCTYPE html>
<html>
<head>
  <title>CVSS v4.0 Contextual Calculator (Complete)</title>
  <meta charset="UTF-8" />
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
    h2 { color: #2c3e50; }
    .section {
      background: #fff; padding: 20px; margin-bottom: 20px;
      border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      border-bottom: 2px solid #8e44ad;
    }
    label { font-weight: bold; display: block; margin-top: 10px; }
    select, input[type=text] { width: 100%; padding: 6px; margin-top: 5px; }
    button {
      margin-top: 20px; padding: 10px 20px;
      font-size: 16px; background: #8e44ad; color: white;
      border: none; border-radius: 5px; cursor: pointer;
    }
    .result { margin-top: 20px; font-size: 18px; font-weight: bold; white-space: pre-wrap; }
    .tooltip {
      display: inline-block; margin-left: 5px;
      cursor: help; color: #8e44ad; font-weight: normal;
    }
    .tooltip:hover::after {
      content: attr(data-tooltip); background: #333; color: #fff;
      padding: 6px 10px; position: absolute; z-index: 100;
      font-size: 13px; border-radius: 4px;
      max-width: 250px; white-space: pre-wrap;
    }
  </style>
</head>
<body>

<h2>CVSS v4.0 Contextual Calculator</h2>

<div class="section">
  <h3>Base Metrics</h3>
  <label>Attack Vector (AV)</label>
  <select id="av">
    <option value="">Not Selected</option>
    <option value="0.85">Network (0.85)</option>
    <option value="0.62">Adjacent (0.62)</option>
    <option value="0.55">Local (0.55)</option>
    <option value="0.2">Physical (0.20)</option>
  </select>

  <label>Attack Complexity (AC)</label>
  <select id="ac">
    <option value="">Not Selected</option>
    <option value="0.77">Low (0.77)</option>
    <option value="0.44">High (0.44)</option>
  </select>

  <label>Privileges Required (PR)</label>
  <select id="pr">
    <option value="">Not Selected</option>
    <option value="N">None (0.85)</option>
    <option value="L">Low (0.62/0.68)</option>
    <option value="H">High (0.27/0.50)</option>
  </select>

  <label>Scope</label>
  <select id="scope">
    <option value="">Not Selected</option>
    <option value="U">Unchanged</option>
    <option value="C">Changed</option>
  </select>

  <label>User Interaction (UI)</label>
  <select id="ui">
    <option value="">Not Selected</option>
    <option value="0.85">None (0.85)</option>
    <option value="0.62">Required (0.62)</option>
  </select>

  <label>Confidentiality</label>
  <select id="c">
    <option value="">Not Selected</option>
    <option value="0.56">High (0.56)</option>
    <option value="0.22">Low (0.22)</option>
    <option value="0.0">None (0.0)</option>
  </select>

  <label>Integrity</label>
  <select id="i">
    <option value="">Not Selected</option>
    <option value="0.56">High (0.56)</option>
    <option value="0.22">Low (0.22)</option>
    <option value="0.0">None (0.0)</option>
  </select>

  <label>Availability</label>
  <select id="a">
    <option value="">Not Selected</option>
    <option value="0.56">High (0.56)</option>
    <option value="0.22">Low (0.22)</option>
    <option value="0.0">None (0.0)</option>
  </select>
</div>

<div class="section">
  <h3>Threat Metrics</h3>
  <label>Exploit Maturity</label>
  <select id="exploitMaturity">
    <option value="1.0">Not Selected</option>
    <option value="0.85">Unconfirmed</option>
    <option value="0.9">Unreported</option>
    <option value="0.95">Proof-of-Concept</option>
    <option value="1.0">Attacked</option>
  </select>

  <label>Remediation Level</label>
  <select id="remediationLevel">
    <option value="1.0">Not Selected</option>
    <option value="0.85">Unavailable</option>
    <option value="0.87">Workaround</option>
    <option value="0.9">Temporary Fix</option>
    <option value="0.95">Official Fix</option>
  </select>

  <label>Report Confidence</label>
  <select id="reportConfidence">
    <option value="1.0">Not Selected</option>
    <option value="0.92">Unknown</option>
    <option value="0.96">Reasonable</option>
    <option value="1.0">Confirmed</option>
  </select>
</div>

<div class="section">
  <h3>Environmental Metrics</h3>
  <label>Confidentiality Requirement</label>
  <select id="cr">
    <option value="1.0">Not Selected</option>
    <option value="0.5">Low</option>
    <option value="1.0">Medium</option>
    <option value="1.5">High</option>
  </select>
  <label>Integrity Requirement</label>
  <select id="ir">
    <option value="1.0">Not Selected</option>
    <option value="0.5">Low</option>
    <option value="1.0">Medium</option>
    <option value="1.5">High</option>
  </select>
  <label>Availability Requirement</label>
  <select id="ar">
    <option value="1.0">Not Selected</option>
    <option value="0.5">Low</option>
    <option value="1.0">Medium</option>
    <option value="1.5">High</option>
  </select>
</div>

<div class="section">
  <h3>Supplemental Metrics</h3>
  <label>Safety</label>
  <select id="safety">
    <option value="1.0">Not Selected</option>
    <option value="1.0">None</option>
    <option value="1.25">Moderate</option>
    <option value="1.5">Critical</option>
  </select>
  <label>Automation</label>
  <select id="automation">
    <option value="1.0">Not Selected</option>
    <option value="1.0">Manual</option>
    <option value="1.25">Partial</option>
    <option value="1.5">Fully</option>
  </select>
  <label>Recovery</label>
  <select id="recovery">
    <option value="1.0">Not Selected</option>
    <option value="1.0">Easy</option>
    <option value="1.25">Moderate</option>
    <option value="1.5">Not Recoverable</option>
  </select>
</div>

<div class="section">
  <button onclick="calculate()">Calculate CVSS</button>
  <div class="result" id="cvssResult"></div>
</div>

<div class="section">
  <h3>Risk Impact Factors</h3>
  <label>Internet Facing</label>
  <select id="internet">
    <option value="0">Not Selected</option>
    <option value="50">Yes (+50)</option>
    <option value="0">No (+0)</option>
  </select>
  <label>Number of Exposed Devices</label>
  <select id="devices">
    <option value="0">Not Selected</option>
    <option value="15">Less than 50 (+15)</option>
    <option value="30">50-100 (+30)</option>
    <option value="50">100+ (+50)</option>
  </select>
  <label>Actively Exploited</label>
  <select id="exploit">
    <option value="0">Not Selected</option>
    <option value="50">Yes (+50)</option>
    <option value="0">No (+0)</option>
  </select>
  <label>Criticality</label>
  <select id="criticality">
    <option value="0">Not Selected</option>
    <option value="15">Low (+15)</option>
    <option value="30">Medium (+30)</option>
    <option value="50">High (+50)</option>
  </select>
  <button onclick="calculateRisk()">Calculate Risk Score</button>
  <div class="result" id="riskResult"></div>
</div>

<div class="section">
  <h3>Combined Dashboard</h3>
  <p>Average of CVSS Score and Risk Score determines action bucket.</p>
  <button onclick="calculateRisk()">Calculate Combined</button>
  <div class="result" id="combinedResult"></div>
</div>

<script>
function val(id) {
  const v = document.getElementById(id).value;
  return v === "" ? null : parseFloat(v);
}

function calculate() {
  const av = val("av"), ac = val("ac"), ui = val("ui"), scope = document.getElementById("scope").value;
  const prRaw = document.getElementById("pr").value;
  const pr = scope === "C"
    ? prRaw === "L" ? 0.68 : prRaw === "H" ? 0.5 : 0.85
    : prRaw === "L" ? 0.62 : prRaw === "H" ? 0.27 : 0.85;

  const c = val("c") ?? 0, i = val("i") ?? 0, a = val("a") ?? 0;
  const cr = val("cr") ?? 1, ir = val("ir") ?? 1, ar = val("ar") ?? 1;
  const threat = val("exploitMaturity") ?? 1;
  const remediation = val("remediationLevel") ?? 1;
  const confidence = val("reportConfidence") ?? 1;
  const safety = val("safety") ?? 1;
  const automation = val("automation") ?? 1;
  const recovery = val("recovery") ?? 1;

  const iss = 1 - ((1 - c * cr) * (1 - i * ir) * (1 - a * ar));
  const impact = scope === "C"
    ? 7.52 * (iss - 0.029) - 3.25 * Math.pow(iss - 0.02, 15)
    : 6.42 * iss;

  const exploit = 8.22 * av * ac * pr * ui;
  let base = impact <= 0 ? 0 :
    scope === "C" ? Math.min(1.08 * (impact + exploit), 10)
                  : Math.min(impact + exploit, 10);

  const adjusted = base * threat * remediation * confidence * safety * automation * recovery;
  const final = Math.min(adjusted, 10).toFixed(1);

  document.getElementById("cvssResult").innerText =
    `Base: ${base.toFixed(2)}\nModifiers: T×R×C×S×A×Rec = ${[threat, remediation, confidence, safety, automation, recovery].join(" × ")}\nAdjusted CVSS Score: ${final}`;
}

function calculateRisk() {
  const internet = val("internet") || 0;
  const devices = val("devices") || 0;
  const exploit = val("exploit") || 0;
  const criticality = val("criticality") || 0;

  const total = internet + devices + exploit + criticality;
  const riskDecimal = total / 100;
  let bucket = "Informational";
  if (riskDecimal >= 0.5) bucket = "Critical - Act Now";
  else if (riskDecimal >= 0.2) bucket = "High - Attend";
  else if (riskDecimal >= 0.1) bucket = "Track";

  document.getElementById("riskResult").innerText =
    `Custom Risk Score: ${riskDecimal.toFixed(2)} – ${bucket}`;

  const cvssText = document.getElementById("cvssResult").innerText;
  const baseMatch = cvssText.match(/Adjusted CVSS Score: ([0-9.]+)/);
  const base = baseMatch ? parseFloat(baseMatch[1]) : 0;
  const combined = ((base + (riskDecimal * 10)) / 2).toFixed(2);

  let action = "Informational";
  if (combined >= 9) action = "Critical - Act Now";
  else if (combined >= 7) action = "High - Attend";
  else if (combined >= 5) action = "Track";

  document.getElementById("combinedResult").innerText =
    `Combined Score: ${combined} – ${action}`;
}
</script>
</body>
</html>
